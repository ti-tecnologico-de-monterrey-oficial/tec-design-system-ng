<div class="bmb_table">
  <div class="bmb_table-container">
    <table
      mat-table
      [dataSource]="dataSource"
      class="bmb_table-content"
      multiTemplateDataRows
    >
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select" sticky>
        <th mat-header-cell *matHeaderCellDef class="bmb_table-checkbox">
          <bmb-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
            [ariaLabel]="checkboxLabel()"
          />
        </th>
        <td mat-cell *matCellDef="let row" class="bmb_table-checkbox">
          <bmb-checkbox
            (change)="$event ? selection.toggle(row) : null; onSelect()"
            [checked]="selection.isSelected(row)"
            [ariaLabel]="checkboxLabel(row)"
            onkeypress="$event.stopPropagation()"
          />
          {{ row.documentos }}
        </td>
      </ng-container>

      <!-- Expand Column -->
      <ng-container matColumnDef="expand" sticky>
        <th
          mat-header-cell
          *matHeaderCellDef
          class="bmb_table-expand"
          aria-label="row actions"
        >
          &nbsp;
        </th>
        <td mat-cell *matCellDef="let row" class="bmb_table-expand">
          <ng-container *ngIf="row.detail">
            <button
              mat-icon-button
              aria-label="expand row"
              (click)="
                expandedElement = expandedElement === row ? null : row;
                $event.stopPropagation()
              "
            >
              <bmb-icon
                [icon]="expandedElement === row ? 'expand_less' : 'expand_more'"
              />
            </button>
          </ng-container>
        </td>
      </ng-container>

      <!-- Display Columns -->
      <ng-container *ngFor="let column of tableColumns; let i = index">
        <ng-container matColumnDef="{{ column.def }}" [sticky]="i === 0">
          <th
            mat-header-cell
            *matHeaderCellDef
            #headerCell
            [matTooltip]="hasEllipsis(headerCell) ? column.label : ''"
            matTooltipPosition="below"
            matTooltipClass="bmb_tooltip"
            [ngClass]="{
              'bmb_table-sticky': i === 0,
              truncated: truncate,
              wrapped: wrap,
            }"
          >
            @if (column.htmlLabel) {
              <ng-template
                [ngTemplateOutlet]="column.htmlLabel"
                [ngTemplateOutletContext]="{
                  column: column,
                  index: i,
                }"
              ></ng-template>
            } @else {
              {{ column.label }}
            }
            <span
              class="bmb_table-resize"
              (mousedown)="onResizeColumn($event, i)"
            ></span>
          </th>
          <td
            mat-cell
            *matCellDef="let row; let a = index"
            #cell
            matTooltipPosition="below"
            [matTooltip]="hasEllipsis(cell) ? row[column.dataKey] : ''"
            matTooltipClass="bmb_tooltip"
            [ngClass]="{
              'bmb_table-sticky': i === 0,
              truncated: truncate,
              wrapped: wrap,
            }"
          >
            @if (isTemplateRef(row[column.dataKey])) {
              <ng-template
                [ngTemplateOutlet]="row[column.dataKey]"
                [ngTemplateOutletContext]="{ row: row }"
              ></ng-template>
            } @else {
              {{ row[column.dataKey]?.propertyName || row[column.dataKey] }}
            }
          </td>
        </ng-container>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions" stickyEnd>
        <th mat-header-cell *matHeaderCellDef class="bmb_table-actions"></th>
        <td mat-cell *matCellDef="let row" class="bmb_table-actions">
          <ng-template [ngTemplateOutlet]="actionTemplate!"> </ng-template>
        </td>
      </ng-container>

      <!-- Row to expand -->
      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let row"
          [attr.colspan]="tableDisplayColumns.length"
        >
          <div
            class="bmb_table-detail"
            [@detailExpand]="row == expandedElement ? 'expanded' : 'collapsed'"
          >
            <ng-container
              *ngTemplateOutlet="detailTemplate; context: { row }"
            ></ng-container>
          </div>
        </td>
      </ng-container>

      <!-- Rows -->
      <tr
        mat-header-row
        *matHeaderRowDef="tableDisplayColumns"
        class="bmb_table-row"
      ></tr>

      <tr
        mat-row
        *matRowDef="let row; columns: tableDisplayColumns; let i = dataIndex"
        class="bmb_table-row"
        [class.bmb_table-expandible]="expandedElement === row"
        [ngClass]="{
          'bmb_table-even': isEven(i),
          'bmb_table-odd': isOdd(i),
        }"
      ></tr>

      <ng-container *ngIf="tableConfig?.isExpandible">
        <tr
          mat-row
          *matRowDef="let row; columns: ['expandedDetail']; let i = dataIndex"
          class="bmb_table-details"
          [class.bmb_table-expanded]="expandedElement === row"
        ></tr>
      </ng-container>
    </table>
  </div>

  <!-- Paginator -->
  <ng-container *ngIf="tableConfig?.isPaginable" sticky>
    <mat-paginator
      #paginator
      [pageSize]="this.paginatorSize"
      [hidePageSize]="true"
    >
    </mat-paginator>

    <div class="bmb_table-paginator">
      <span class="bmb_table-paginator-text">{{ getPaginationText() }}</span>
      <button
        [disabled]="!paginator || !paginator.hasPreviousPage()"
        [ngClass]="{
          'bmb_table-paginator-btn-disabled':
            !paginator || !paginator.hasPreviousPage(),
        }"
        (click)="paginator.firstPage()"
        class="bmb_table-paginator-btn"
      >
        <bmb-icon
          icon="keyboard_double_arrow_left"
          class="bmb_table-paginator-icon"
        />
      </button>
      <button
        [disabled]="!paginator || !paginator.hasPreviousPage()"
        [ngClass]="{
          'bmb_table-paginator-btn-disabled':
            !paginator || !paginator.hasPreviousPage(),
        }"
        (click)="paginator.previousPage()"
        class="bmb_table-paginator-btn"
      >
        <bmb-icon icon="keyboard_arrow_left" class="bmb_table-paginator-icon" />
      </button>
      <button
        [disabled]="!paginator || !paginator.hasNextPage()"
        [ngClass]="{
          'bmb_table-paginator-btn-disabled':
            !paginator || !paginator.hasNextPage(),
        }"
        (click)="paginator.nextPage()"
        class="bmb_table-paginator-btn"
      >
        <bmb-icon
          icon="keyboard_arrow_right"
          class="bmb_table-paginator-icon"
        />
      </button>
      <button
        [disabled]="!paginator || !paginator.hasNextPage()"
        [ngClass]="{
          'bmb_table-paginator-btn-disabled':
            !paginator || !paginator.hasNextPage(),
        }"
        (click)="paginator.lastPage()"
        class="bmb_table-paginator-btn"
      >
        <bmb-icon
          icon="keyboard_double_arrow_right"
          class="bmb_table-paginator-icon"
        />
      </button>
    </div>
  </ng-container>
</div>
